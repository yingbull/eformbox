<!DOCTYPE html>
<html>
<head>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>LifestyleRx Referral Form</title>
<style>
 body, textarea {
	font-size:12px;
	font-family:sans-serif;
	font-style:normal;
	font-weight:normal;
	text-align:left;
	background-color:transparent;
 }
 input {
	-moz-box-sizing: content-box;
	-webkit-print-color-adjust: exact;
	-webkit-box-sizing: content-box;
	box-sizing: content-box;
 }
 .Xbox {
	width:14px;
	height:14px;
	font-weight:bold;
	text-align:center;
	background-color:white;
 }
 .sig {
	border:2px dotted blue;
	color:Black;
	background-color:white;
 }
</style>

<style type="text/css" media="screen" >
 .noborder {
	border:1px solid; !important
 }
 html.touch #content {
	float:left;
	width:92%;
}
 html.touch #scrollgrabber {
	float:right;
	width:4%;
	margin-right:2%;
	background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAAFCAAAAACh79lDAAAAAXNSR0IArs4c6QAAABJJREFUCB1jmMmQxjCT4T/DfwAPLgOXlrt3IwAAAABJRU5ErkJggg==)
 }
 html.borderradius #scrollgrabber {
	border-radius: 1em;
 }
</style>

<style type="text/css" media="print">
 .DoNotPrint {
	display:none;
 }
 .noborder {
	border:0px;
	background: transparent;
</style>

<!-- jQuery for greater functionality -->
<script type="text/javascript" src="../library/jquery/jquery-3.6.4.min.js" ></script>
<script> window.jQuery || document.write('<script src="../js/jquery-1.12.3.js">< \/script>') </script>

<!-- Freeform Signatures -->

<script type="text/javascript" src="${oscar_javascript_path}jquery/jSignature.min.js"></script>

<script type="text/javascript">
jQuery(document).ready(function() {
	$("#CanvasSignature1").jSignature({'decor-color':'rgba(255, 255, 255, 0.0)'})
	var pdf = jQuery("input[name='pdfButton']");
	if (pdf.length != 0) {
		pdf.attr('onclick', '').off('click');
		pdf.attr('value', 'PDF');
		pdf.click(function(){saveSig();submitPrintButton(false);});
		}
	var pdfSave = jQuery("input[name='pdfSaveButton']");
	if (pdfSave.length != 0) {
		pdfSave.attr('onclick', '').off('click');
		pdfSave.attr('value', 'Submit & PDF');
		pdfSave.click(function(){saveSig();submitPrintButton(true);});
		}
})
</script>

<script type="text/javascript">
function saveSig(){
	var $sig=$("#CanvasSignature1");
	var datapair=new Array();
	datapair=$sig.jSignature("getData","base30");
	document.getElementById("StoreSignature1").value=datapair.join(",");
}
function clearSig(){
	$("#CanvasSignature1").jSignature("reset");
}
function loadSig(){
	var provNum = '';
	var userBillingNo = $('#user_ohip_no').val();
	if (parseInt(userBillingNo) > 100) {
		// then a valid billing number so use the current user id 
		provNum = $('#user_id').val(); 
	} else { 
		provNum = $('#doctor_no').val(); 
	}
	var $sig=$("#CanvasSignature1");
	var data
	data=document.getElementById("StoreSignature1").value;
	$sig.jSignature("setData","data:"+ data) ;
}
</script>

<script language="javascript">
function formPrint(){
	window.print();
} 
</script>

<!-- scripts to confirm closing of window if it hadnt been saved yet -->
<script language="javascript">
//keypress events trigger dirty flag
var needToConfirm = false;
document.onkeyup=setDirtyFlag;
function setDirtyFlag(){
	needToConfirm = true;
}
function releaseDirtyFlag(){
	needToConfirm = false; //Call this function to prevent an alert.
	document.getElementById('FormName').submit()
}
window.onbeforeunload = confirmExit;
function confirmExit(){
	if (needToConfirm){
		 return "You have attempted to leave this page. If you have made any changes to the fields without clicking the Save button, your changes will be lost. Are you sure you want to exit this page?";
	 }
}
</script>


<!-- main calendar program -->
<script type="text/javascript" src="../share/calendar/calendar.js"></script>
<script type="text/javascript" src="../share/calendar/lang/calendar-en.js"></script>
<script type="text/javascript" src="../share/calendar/calendar-setup.js"></script>
<link rel="stylesheet" type="text/css" media="all" href="../share/calendar/calendar.css" title="win2k-cold-1" />

</head>

<body onload="loadSig();">
<form method="post" name="FormName" id="FormName" >
<div id="page1" style="position:relative;" >
<img id="BGImage1" src="${oscar_image_path}lifestylerx.png" style="position: relative; left: 0px; top: 0px; width:750px">

<input name="type2" id="type2" type="text" class="Xbox" style="position:absolute; left:99px; top:222px;" >
<input name="metabolic" id="metabolic" type="text" class="Xbox" style="position:absolute; left:99px; top:255px;" >
<input name="prediabetes" id="prediabetes" type="text" class="Xbox" style="position:absolute; left:285px; top:222px;" >
<input name="other" id="other" type="text" class="Xbox" style="position:absolute; left:285px; top:255px;" >
<input name="insulin" id="insulin" type="text" class="Xbox" style="position:absolute; left:430px; top:222px;" >
<input name="yes" id="yes" type="text" class="Xbox" style="position:absolute; left:373px; top:287px;" >
<input name="no" id="no" type="text" class="Xbox" style="position:absolute; left:430px; top:287px;" >
<input name="otherline" id="otherline" type="text" class="noborder" style="position:absolute; left:352px; top:246px; width:196px; height:20px; " >
<input name="first" id="first" type="text" class="noborder" style="position:absolute; left:81px; top:397px; width:138px; height:23px; "  oscarDB=patient_nameF>
<input name="last" id="last" type="text" class="noborder" style="position:absolute; left:226px; top:397px; width:142px; height:23px; "  oscarDB=patient_nameL>
<input name="phn" id="phn" type="text" class="noborder" style="position:absolute; left:375px; top:397px; width:195px; height:23px; "  oscarDB=hinc>
<input name="phone" id="phone" type="text" class="noborder" style="position:absolute; left:81px; top:444px; width:241px; height:23px; "  oscarDB=phone>
<input name="email" id="email" type="text" class="noborder" style="position:absolute; left:375px; top:443px; width:253px; height:23px; "  oscarDB=email>
<textarea name="additional" id="additional" type="text" class=" noborder" style="position:absolute; left:81px; top:494px; width:585px; height:143px; " ></textarea>
<input name="provider" id="provider" type="text" class="noborder" style="position:absolute; left:160px; top:704px; width:206px; height:23px; "  oscarDB=current_user>
<input name="billing" id="billing" type="text" class="noborder" style="position:absolute; left:127px; top:748px; width:201px; height:23px; "  oscarDB=current_user_ohip_no>
<input name="date" id="date" type="text" class="noborder" style="position:absolute; left:111px; top:859px; width:234px; height:23px; "  oscarDB=today>
<textarea name="stamp" id="stamp" type="text" class=" noborder" style="position:absolute; left:377px; top:726px; width:289px; height:87px; "  oscarDB=clinic_label></textarea>
<div id="CanvasSignature1" class="sig" style="position:absolute; left:135px; top:796px; width:180px; height:45px;; z-index:20;">
</div>
<input type="hidden" name="StoreSignature1" id="StoreSignature1" value="">
<img id="Signature1" src="BNK.png" style="position:absolute; left:135px; top:796px; width:148px; height:37px;; z-index:12;">

<input type="hidden" name="DoctorName" id="DoctorName" oscarDB=doctor>
<input type="hidden" name="CurrentUserName" id="CurrentUserName" oscarDB=current_user>
<input type="hidden" name="SubmittedBy" id="SubmittedBy">
<input type="hidden" name="user_id" id="user_id" oscarDB=current_user_id>
<input type="hidden" name="user_ohip_no" id="user_ohip_no" oscarDB=current_user_ohip_no>
<input type="hidden" name="doctor_no" id="doctor_no" oscarDB=doctor_provider_no>
<div id="signatureDisplay"></div>
<input type="hidden" name="signatureValue" id="signatureValue">


<div class="DoNotPrint" id="BottomButtons" style="position: absolute; top:971px; left:0px;">
	<table><tr><td>
		Subject: <input name="subject" id="subject" size="40" type="text"> <br> 
		<input value="Submit" name="SubmitButton" id="SubmitButton" type="button" onclick=" saveSig(); releaseDirtyFlag();"> 
		<input value="Save Sig" name="SaveSigButton" id="SaveSigButton" type="button" onclick="saveSig();"> 
		<input value="Clear Sig" name="ClearButton" id="ClearButton" type="button" onclick="clearSig();"> 
		 <input value="Reset" name="ResetButton" id="ResetButton" type="reset"> 
			<input value="Print" name="PrintButton" id="PrintButton" type="button" onclick="formPrint();"> 
	</td></tr></table>

<!-- Copy Left -->
<a rel="liscence" href="https://www.gnu.org/licenses/gpl.html" target="blank"><img alt="GPLv3" src="https://www.gnu.org/graphics/gplv3-88x31.png"/></a><br>
</div>
</div>
 </form>

<!-- Define Date Calendars -->
<script type="text/javascript">
	Calendar.setup( { inputField : "date", ifFormat : "%Y-%m-%d",  button : "date" } );
</script>


<!-- Xbox Script -->
<script type="text/javascript">
	var b = document.getElementsByClassName('Xbox');
	for (var i = 0; i < b.length; i++) {
		b[i].onclick = function(){
			let x = this.id;
			if (document.getElementById(x).value.length < 1) {
				document.getElementById(x).value ='X';
			} else {
				document.getElementById(x).value ='';
			}
			return false;
		}
	}
</script>

</body>
</html>
